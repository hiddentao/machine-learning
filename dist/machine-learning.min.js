!function(t,r){"use strict";"function"==typeof define&&define.amd?define(["linear-algebra"],r):"object"==typeof exports?module.exports=r(require("linear-algebra")):t.machineLearning=r(t.linearAlgebra)}(this,function(t){"use strict";var r=Number.EPSILON||1e-12,e=function(t,r,e){throw new Error("machine-learning: ["+t+"_"+r+"] "+e)};return function(n){n||(n=t());var a={Matrix:n.Matrix,Vector:n.Vector};return a.normalizeFeatures=function(t){var e,n,o,i,s,u=t.cols,c=t.rows,d=new Array(c),f=new a.Vector.zero(c);for(i=0;u>i;++i){for(s=i+1,o=0;c>o;++o)f.data[0][o]=t.data[o][i],Array.isArray(d[o])||(d[o]=new Array(u+1),d[o][0]=1);for(e=f.getSum()/c,o=0;c>o;++o)d[o][s]=t.data[o][i]-e,f.data[0][o]=d[o][s]*d[o][s];for(n=Math.sqrt(f.getSum()/(c-1)),0===n&&(n=r),o=0;c>o;++o)d[o][s]/=n}return new a.Matrix(d)},a.gradientDescent=function(t,r,e,n,o){t=a.normalizeFeatures(t);for(var i,s,u,c=t.rows,d=t.cols,f=new a.Vector.zero(c),h=a.Vector.zero(d).trans_(),g=a.Vector.zero(d).trans_(),l=e(t,h,r),_=o;l>0&&0<_--;){for(i=l,u=0;d>u;++u){for(s=0;c>s;++s)f[s]=(t.dot(s,h)-r[s])*t.data[s][u];g.data[u][0]=n*f.getSum()/c}h.minus_(g),l=e(t,h,r),l>i&&(h.plus_(g),n/=2)}return{theta:h,cost:l,alpha:n,iters:o-_}},a.LinReg=function(t){this._dataX=[],this._dataY=[],this._nF=t},a.LinReg.prototype.addData=function(t){for(var r=t.length,n=0;r>n;++n)t[n].length<this._nF&&e("LinReg","addData","Not enough data"),this._dataX.push(t[n].slice(0,this._nF-1)),this._dataY.push(t[n][this._nF-1])},a.LinReg.prototype.solve=function(){var t=new a.Matrix(this._dataX),r=new a.Matrix(this._dataY).trans_();return a.gradientDescent(t,r,a.LinReg.costFunction)},a.LinReg.costFunction=function(t,r,e){var n=e.rows,a=t.dot(r).minus_(e);return a.mul(a).getSum()/(2*n)},a}});