!function(t,r){"use strict";"function"==typeof define&&define.amd?define(["linear-algebra"],r):"object"==typeof exports?module.exports=r(require("linear-algebra")):t.machineLearning=r(t.linearAlgebra)}(this,function(t){"use strict";var r=Number.EPSILON||1e-12;return function(e){e||(e=t());var a={Matrix:e.Matrix,Vector:e.Vector};return a.normalizeFeatures=function(t){var e,n,o,i,s=t.cols,u=t.rows,c=new Array(u),d=new a.Vector.zero(u);for(i=0;s>=i;++i){for(o=0;u>o;++o)d.data[0][o]=t.data[o][i],Array.isArray(c[o])||(c[o]=new Array(s+1),c[o][0]=1);for(e=d.getSum()/u,o=1;u>=o;++o)c[o][i]=t.data[o-1][i]-e,d.data[0][o]=c[o][i]*c[o][i];for(n=Math.sqrt(d.getSum()/u),n+=r,o=1;u>=o;++o)c[o][i]/=n}return new a.Matrix(c)},a.gradientDescent=function(t,r,e,n,o){t=a.normalizeFeatures(t);for(var i,s,u,c=t.rows,d=t.cols,f=new a.Vector.zero(c),l=a.Vector.zero(d),g=a.Vector.zero(d),h=e(t,l,r),p=o;h>0&&0<p--;){for(i=h,u=0;d>u;++u){for(s=0;c>s;++s)f[s]=(t.dot(s,l)-r[s])*t.data[s][u];g.data[u]=n*f.getSum()/c}l.minus_(g),h=e(t,l,r),h>i&&(l.plus_(g),n/=2)}return{theta:l,cost:h,alpha:n,iters:o-p}},a.LinearReg=function(t){this._dataX=[],this._dataY=[],this._nF=t},a.LinearReg.prototype.addData=function(t){for(var r=t.length,e=0;e<t.length;++e)this._dataX.push(t[e].slice(0,r-1)),this._dataY.push(t[e][r-1])},a.LinearReg.prototype.solve=function(){var t=new a.Matrix(this._dataX),r=new a.Matrix(this._dataY).trans_();return a.gradientDescent(t,r,a.LinearReg.costFunction)},a.LinearReg.costFunction=function(t,r,e){var a=e.cols,n=t.dot(r).minus_(e);return n.trans().dot_(n).data[0][0]/(2*a)},a}});