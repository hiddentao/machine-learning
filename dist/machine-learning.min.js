!function(t,r){"use strict";"function"==typeof define&&define.amd?define(["linear-algebra"],r):"object"==typeof exports?module.exports=r(require("linear-algebra")):t.machineLearning=r(t.linearAlgebra)}(this,function(t){"use strict";var r=Number.EPSILON||1e-12,e=function(t,r,e){throw new Error("machine-learning: ["+t+"_"+r+"] "+e)};return function(n){n||(n=t());var a={Matrix:n.Matrix,Vector:n.Vector};return a.normalizeFeatures=function(t){var e,n,i,o,s,u=t.cols,c=t.rows,d=new Array(c),f=new a.Vector.zero(c);for(o=0;u>o;++o){for(s=o+1,i=0;c>i;++i)f.data[0][i]=t.data[i][o],Array.isArray(d[i])||(d[i]=new Array(u+1),d[i][0]=1);for(e=f.getSum()/c,i=0;c>i;++i)d[i][s]=t.data[i][o]-e,f.data[0][i]=d[i][s]*d[i][s];for(n=Math.sqrt(f.getSum()/(c-1)),0===n&&(n=r),i=0;c>i;++i)d[i][s]/=n}return new a.Matrix(d)},a.gradientDescent=function(t,r,e,n,i){t=a.normalizeFeatures(t);for(var o,s,u,c,d=t.rows,f=t.cols,h=new a.Vector.zero(d),g=a.Vector.zero(f).trans_(),l=a.Vector.zero(f).trans_(),_=e(t,g,r),m=0;_>0&&i>m;){for(m++,o=_,c=t.dot(g).minus_(r),u=0;f>u;++u){for(s=0;d>s;++s)h[s]=c.data[s][u]*t.data[s][u];l.data[u][0]=n*h.getSum()/d}g.minus_(l),_=e(t,g,r),_>o&&(g.plus_(l),n/=2)}return{theta:g,cost:_,alpha:n,iters:i-m}},a.LinReg=function(t){this._dataX=[],this._dataY=[],this._nF=t},a.LinReg.prototype.addData=function(t){for(var r=t.length,n=0;r>n;++n)t[n].length<this._nF&&e("LinReg","addData","Not enough data"),this._dataX.push(t[n].slice(0,this._nF-1)),this._dataY.push(t[n][this._nF-1])},a.LinReg.prototype.solve=function(){var t=new a.Matrix(this._dataX),r=new a.Matrix(this._dataY).trans_();return a.gradientDescent(t,r,a.LinReg.costFunction)},a.LinReg.costFunction=function(t,r,e){var n=e.rows,a=t.dot(r).minus_(e);return a.mul(a).getSum()/(2*n)},a}});