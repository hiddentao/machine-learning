!function(t,r){"use strict";"function"==typeof define&&define.amd?define(["linear-algebra"],r):"object"==typeof exports?module.exports=r(require("linear-algebra")):t.machineLearning=r(t.linearAlgebra)}(this,function(t){"use strict";var r=Number.EPSILON||1e-12,e=function(t,r,e){throw new Error("machine-learning: ["+t+"_"+r+"] "+e)};return function(a){a||(a=t());var n={Matrix:a.Matrix,Vector:a.Vector};return n.normalizeFeatures=function(t){var e,a,i,o,s,u=t.cols,c=t.rows,d=new Array(c),f=new n.Vector.zero(c);for(o=0;u>o;++o){for(s=o+1,i=0;c>i;++i)f.data[0][i]=t.data[i][o],Array.isArray(d[i])||(d[i]=new Array(u+1),d[i][0]=1);for(e=f.getSum()/c,i=0;c>i;++i)d[i][s]=t.data[i][o]-e,f.data[0][i]=d[i][s]*d[i][s];for(a=Math.sqrt(f.getSum()/(c-1)),0===a&&(a=r),i=0;c>i;++i)d[i][s]/=a}return new n.Matrix(d)},n.gradientDescent=function(t,r,e,a,i){t=n.normalizeFeatures(t);for(var o,s,u,c=t.rows,d=t.cols,f=new n.Vector.zero(c).trans_(),h=n.Vector.zero(d).trans_(),g=n.Vector.zero(d).trans_(),l=e(t,h,r),_=l,m=0;l>0&&i>m;){for(m++,u=t.dot(h).minus_(r),s=0;d>s;++s){for(o=0;c>o;++o)f.data[o][0]=u.data[o][0]*t.data[o][s];g.data[s][0]=a*f.getSum()/c}h.minus_(g),l=e(t,h,r),l>_?(h.plus_(g),a/=2):_=l}return{theta:h,cost:l,alpha:a,iters:m}},n.LinReg=function(t){this._dataX=[],this._dataY=[],this._nF=t},n.LinReg.prototype.addData=function(t){for(var r=t.length,a=0;r>a;++a)t[a].length<this._nF&&e("LinReg","addData","Not enough data"),this._dataX.push(t[a].slice(0,this._nF-1)),this._dataY.push(t[a][this._nF-1])},n.LinReg.prototype.solve=function(){var t=new n.Matrix(this._dataX),r=new n.Matrix(this._dataY).trans_();return n.gradientDescent(t,r,n.LinReg.costFunction)},n.LinReg.costFunction=function(t,r,e){var a=e.rows,n=t.dot(r).minus_(e);return n.mul(n).getSum()/(2*a)},n}});